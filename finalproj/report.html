<html>
    <style>
    body {
        background-color: white;
        padding: 100px;
        width: 1000px;
        margin: auto;
        text-align: left;
        font-weight: 300;
        font-family: 'Open Sans', sans-serif;
        color: #121212;
    }
    h1, h2, h3, h4 {
        font-family: 'Source Sans Pro', sans-serif;
    }
    kbd {
        color: #121212;
    }
    </style>

    <header>
      <title>CS184 Spring 2023 Final Project - Black Hole Ray Marcher</title>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async
              src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
      </script>
    </header>

    <body>
        <!-- <div align = "middle">
            <img src = "" width = 800px height = 400px>
        </div> -->
        <div align="middle">
            <h1>Ray Marching for Rendering Physically Realistic Black Holes </h1>
            <h2>CS184 Sp23 Final Project Report</h2>
            
            <h4>Team Members: Grace Chen, Jerry Zhang, Mingyang Wang, Irene Geng</h4>
        </div>
        <div align="middle">
            <table style="width:100%">
              <tr align="center">
                <td>
                  <img src="final_images/texture_3_bh.png" align="right" width="400px"/>
                </td>
                <td>
                  <img src="final_images/texture_2_bh.png" align="left" width="400px"/>
                </td>
              </tr>
              <tr align="center">
                <td>
                  <img src="final_images/texture_1_bh.png" align="right" width="400px"/>
                </td>
                <td>
                  <img src="final_images/texture_1_bh_zoom.png" align="left" width="400px"/>
                </td>
              </tr>
            </table>
        </div>
        <br>
        
        <div>
            <h1> Abstract </h1>
            <div>
                <p> 
                    In most graphics applications, we assume that light travels in a perfectly straight line. While this is a safe assumption in most scenarios, this is not always the case. 
                </p>
                <p> 
                    A black hole is an extremely dense object in space with a gravitational pull so strong that it prevents anything, including light, from escaping once it gets too close. Einstein‚Äôs theory of general relativity describes gravity as the result of curvature of spacetime; when light travels through curved spacetime generated by black holes (or other very massive objects), the light‚Äôs behavior becomes warped and bends around the black hole.                
                </p>
                <p>
                    In this project, we use ray marching methods to render a realistic black hole. We first present a Cartesian coordinate method to render a Schwarzschild black hole (non-rotating, spherically symmetric), and then transition to Boyer-Lindquist coordinates to generalize renderings to a Kerr black hole (rotating, potentially asymmetric). We apply various texture mappings onto the black hole‚Äôs accretion disk and starfield background as well as a bloom filter to create the final output renders.
                </p>

                <p> See link to our 
                    <a href="https://docs.google.com/presentation/d/1_prJLe6kyc7dSLX8dIAgGah_qeH1JckdDUp0xO9Doh8/edit#slide=id.p"> Presentation Slides</a>
                </p>
                <p> See link to our 
                    <a href="https://drive.google.com/file/d/1J1dCBIy9_wyOX5tgKADQYcKYupsaswPQ/view?usp=share_link"> Final Video </a>
                </p>
                
            </div>
            
        </div>
        <br>
        <div>
            <h1> Technical Approach </h1>
            <h2> Preface: Setup and Physics Overview  </h2>
            <div>
                <p>
                  The black holes that we consider can be entirely described by their mass and angular momentum; all other relevant properties may be calculated deterministically from these two properties. Every black hole has a Schwarzschild radius, which is defined as: \(r_s = 2GM / c^2\)
                </p>
                <p>
                    We define our coordinate systems such that the black hole is centered at the origin. As is typical practice in theoretical physics, parameters are normalized such that the mass of the black hole \(M\), Gravitational Constant \(G\), and speed of light \(c\) are set to 1. As a result, all distances are (implicitly) measured in units of the black hole‚Äôs Schwarzschild radius. We point the camera directly at the black hole such that the black hole is centered in its field of view.
                </p>
                <div align="middle">
                    <table style="width:100%">
                    <tr align="center">
                        <td>
                        <img src="physics/photons.png" align="middle" width="400px"/>
                        <figcaption></figcaption>
                        </td>
                        
                    </tr>
                    </table>
                </div>
                <p> The above diagram [10] shows several photon trajectories as they travel past the black hole. Any ray that travels close enough to the black hole and crosses the <i>event horizon</i> (the black circle, with radius equal to \(r_s\)) becomes trapped, forming the black hole‚Äôs ‚Äúshadow.‚Äù Rays outside of this threshold are bent around and may orbit, but do not get trapped in, the black hole. Note that light can orbit multiple times around the black hole, as is the case with one of the purple rays.</p>
                <div align="middle">
                    <table style="width:100%">
                    <tr align="center">
                        <td>
                        <img src="physics/diagram.png" align="middle" width="800px"/>
                        <figcaption></figcaption>
                        </td>
                        
                    </tr>
                    </table>
                </div>
                <p> 
                    The above diagram (one of our own renders!) demonstrates some of the behavior we expect to see when rendering black holes. At the center, we see the Black Hole Shadow, surrounded by a bright photon ring. The photon ring is a region where the black hole‚Äôs gravity forces photons into orbits around the event horizon. The Accretion Disk, despite being modeled as a perfectly flat disk, appears above and below the shadow due to light rays curving around the black hole.
                </p>
                <p>
                    The Einstein Ring, represented as the dotted white circle, is the point(s) at which all light rays are perfectly bent such that they hit the same object, creating ‚Äúrings‚Äù of distortion. Objects visible outside of the Einstein Ring have secondary images reflected on the opposite side of the black hole inside the Einstein Ring, such as shown in the two orange circles and the two yellow circles.

                </p>
                <p>
                    The exact mechanisms for studying and tracing light paths in the presence of a black hole require a much deeper study of (and probably a PhD in) theoretical physics, and is quite out of scope for the purposes of this project (especially since our group is lacking in both physics knowledge and PhDs). Below, we present two different approaches for rendering black holes. The first is a (relatively) crude approximation: a simple ray marcher that uses Cartesian coordinates and Forward Euler integration to render Schwarzschild black holes. Then, we build a more physically accurate, generalizable representation using Boyer-Lindquist coordinates and Cash-Karp numerical integration to render either Schwarzschild or Kerr black holes.

                </p>

                
            </div>

            <h2> Initial Approach: Schwarzschild</h2>
            <div>
                <h4> Overview: Ray Marching</h4>
                <div>
                    <p> 
                        A Schwarzschild black hole is a simple model for a perfectly symmetric, spherical black hole that has zero charge and zero angular momentum. These assumptions provide a simpler and more well-understood model for light behavior.
                    </p>
                    <p>
                        Because light rays do not travel in straight paths around a black hole, we can no longer use traditional ray tracing line intersection tests to check for intersections. Instead, we use ray marching, a technique that simulates the (non-linear) path of a light ray by taking small steps through a scene, updating ray parameters where necessary, and computing intersections with the objects the ray encounters along the way.
                    </p>
                    <p> 
                        At any position, we approximate the ray‚Äôs acceleration due to gravity with: \(acceleration = -1.5 h^2 \frac{\hat{r}}{||r|| ^ 5}\)
                    </p>
                    <p>
                        where \(h\) is defined as the magnitude of the ray‚Äôs specific angular momentum, a constant value calculated once per ray, and \(r\) is defined as the vector pointing from the center of the sphere to the photon‚Äôs current position. See Appendix A for details and derivations.
                    </p>
                </div>

                <h3> Forward Euler Integration</h3>
                <div>
                    <p>
                        With this acceleration, we can then march rays ‚Äúbackwards‚Äù in time using Forward Euler integration, updating the photon‚Äôs position and velocity at each time step. 
                        \[curr\_position = prev\_position + velocity * dt\]
                        \[curr\_velocity = prev\_velocity + acceleration * dt\]
                    </p>
                    
                    <p>
                        Since our black hole is represented by a sphere centered at the origin, we can test whether a ray has intersected the black hole with the standard geometric ray-sphere intersection between <i>prev_position</i> and <i>curr_position</i> of each ray marching timestep. This yields the following result:
                    </p>
                    <div align="middle">
                        <table style="width:100%">
                        <tr align="center">
                            <td>
                            <img src="schwarzchild/ray_tracing.png" align="middle" width="400px"/>
                            <figcaption>Standard Ray Tracing: Sphere with Debug Coloring</figcaption>
                            </td>
                            <td>
                            <img src="schwarzchild/ray_marching.png" align="middle" width="400px"/>
                            <figcaption>Ray Marching: "Black Hole" with Debug Coloring</figcaption>
                            </td>
                        </tr>
                        </table>
                    </div>
                    <p> 
                        <i>
                            Notable Observations: Since light rays are bent toward the sphere/black hole, the image of the sphere appears bigger as a result. Additionally, this bending of light enables us to see the entire surface of the sphere ‚Äì we can see colors from the back side of the sphere (yellow and green) along the edges of the image!
                        </i>

                    </p>
                    <p>
                        We represent the black hole‚Äôs accretion disk as a perfectly flat disk with a normal vector (corresponding to the disk‚Äôs plane), inner radius, and outer radius (the shape of a 2D donut). Similar to the black hole, we conduct ray-plane intersection at every ray marching timestep; if it intersects the accretion disk plane, we know that the ray intersects the accretion disk itself if the intersection point‚Äôs distance from the origin is between the inner and outer radius of the accretion disk.

                    </p>
                    <p>
                        If the ray has not intersected either the sphere or the accretion disk after taking the maximum number of steps, or the ray travels a sufficiently large distance away from the black hole (ie \(20r_s\)) , we conclude that the ray escapes to infinity; in the physical model, this corresponds to the ray originating from the background (aka the celestial sphere).
                    </p>
                    <p>
                        Additionally, we implement texture mapping for the black hole surface, accretion disk, and background for debugging as well as preparation for rendering realistic accretion disks and starfield backgrounds. Mapping checkerboard grid patterns provide a helpful visualization for the behavior of light in our render:
                    </p>
                    <div align="middle">
                        <table style="width:100%">
                        <tr align="center">
                            <td>
                            <img src="schwarzchild/ray_tracing_checker.png" align="middle" width="400px"/>
                            <figcaption>Standard Ray Tracing </figcaption>
                            </td>
                            <td>
                            <img src="schwarzchild/ray_marching_checker.png" align="middle" width="400px"/>
                            <figcaption>Ray Marching</figcaption>
                            </td>
                        </tr>
                        </table>
                    </div>
                    <p>
                        <i>
                            Notable Observations: The accretion disk is represented as a 2D disk, but light curving over/under the black hole causes it to appear in front, on top of, and underneath the black hole. The horizontal red line in the background is distorted and bends over the black hole, while a secondary image is produced below the black hole. Similarly to the previous example, we can see the entirety of the black hole surface, resulting in a denser (blue/white) checkerboard pattern.
                        </i>
                    </p>
                    <p>
                        Below, we show two images with proper accretion disk and starfield textures rendered with the above method:

                    </p>
                    <div align="middle">
                        <table style="width:100%">
                        <tr align="center">
                            <td>
                                <img src="schwarzchild/schwarzchild_1.png" align="middle" width="400px"/>
                            </td>
                            <td>
                                <img src="schwarzchild/schwarzchild_2.png" align="middle" width="400px"/>
                            </td>
                        </tr>
                        </table>
                    </div>
                </div>
                
            </div>

            <h2> Second Approach: Kerr Black Hole</h2>
            <div>
                <h4> Overview and Limitations of the previous approach</h4>
                <div>
                    <p>
                        A Kerr black hole is a more complex model for a black hole that has non-zero angular momentum (but still zero charge). Unfortuantely, the curvature of black hole spacetime means that they cannot be easily or properly represented by Cartesian coordinates. To better account for the physical effects of the black hole's rotation, we instead use Boyer-Lindquist coordinates, a type of coordinate system used in the theory of general relativity to describe the geometry of spacetime around any rotating massive object (like black holes).

                    </p>
                    <p>
                        Additionally, the Forward Euler Integration method used in the previous section is potentially unstable and ill-defined. The previous renders required very small step sizes, causing renders to be slow and inefficient. Moreover, moving the camera position far away would sometimes cause our rays to skip portions of or the entire black hole/accretion disk. For example, in the image below, we observe a hole in the center of the black hole:

                    </p>
                    <div align="middle">
                        <table style="width:100%">
                        <tr align="center">
                            <td>
                                <img src="kerr/kerr_limitations.png" align="middle" width="400px"/>
                            </td>
                        </tr>
                        </table>
                    </div>
                    <p>
                        The methods defined below aim to solve these issues.
                    </p>
                </div>

                <h3>Improvments: Boyer-Lindquist</h3>
                <div>
                    <p>
                        Boyer-Lindquist Coordinates consist of 4 components: \((r, \theta, \phi, t)\). The first 3 coordinates, \((r, \theta, \phi)\), are oblate spherical coordinates. Like in the Schwarzschild case, these coordinates are typically normalized such that the black hole radius is 1. We also have a \(t\)-coordinate, which marks the time of an event relative to a distant, unmoving observer. This coordinate system allows us to take into account the asymmetric effect of a black hole‚Äôs rotation on spacetime curvature.
                    </p>
                    <p> Boyer-Lindquist Coordinates can be converted into Cartesian coordinates via:

                        <ul>
                            <li>
                                \(x = \sqrt{r^2 + a^2}\sin{\theta}\cos{\phi}\)
                            </li>
                            <li>
                                \(y = \sqrt{r^2 + a^2}\sin{\theta}\sin{\phi}\)
                            </li>
                            <li>
                                \(z = r\cos{\theta}\)
                            </li>
                        </ul>
                    </p>
                    <p> The Kerr metric describes the geometry of spacetime around a black hole of mass \(M\) and angular momentum \(J\). In Boyer-Lindquist coordinates, distance (the line element) is defined by:
                        \[ds^2=-\frac{\Delta }{\Sigma }(dt-a sin^2\theta d\phi )^2+\frac{sin^2\theta }{\Sigma}((r^2+a^2)d\phi -adt)^2+\frac{\Sigma }{\Delta }dr^2+ \Sigma d\theta ^2\]
                        <ul>
                            <li>
                                \(\Delta = r^2 - 2 M r + a^2 + Q^2\): the discriminant for electrical charge
                            </li>
                            <li>
                                \(\Sigma = r^2 + a^2 \cos^2(\theta)\)
                            </li>
                            <li>
                                \(a = \frac{J}{Mc}\) : Kerr parameter - the ratio between the black hole‚Äôs angular momentum and mass. \(a = 0\) for non-rotating black holes and \(0 < a < 1\) for rotating black holes.
                            </li>
                            <li>
                                As in typical practice, we normalize \(M = 1\).
                            </li>
                            <li>
                                Kerr black holes have no electric charge, so \(Q = 0\).  
                            </li>
                        </ul>
                    </p>
                    <p>
                        Around a Kerr black hole, a photon follows a null geodesic path, the shortest distance path between two points in curved spacetime. This can be determined by solving a system of differential equations, shown in the table below, where derivatives are taken with respect to propertime ùúè.\(p = (p_r, p_{\theta}, p_{\phi}, p_t)\) is the ray‚Äôs four-momentum, a generalization of three-dimensional momentum to spacetime. As a convenient convention, we set the ray‚Äôs conserved energy, \(-p_t = 1\). 
                        <div align="middle">
                            <table style="width:100%; border: 1px solid">
                        
                                <tr align="center">
                                    <td style="border: 1px solid">
                                        \(r' = \frac{\Delta}{\Sigma}p_r\)
                                    </td>
                                    <td style="border: 1px solid">
                                        \(p_r' = \frac{(r - 1) * (-\kappa) + 2r(r^2 + a^2) - 2aL}{\Delta\Sigma} - \frac{2p_r^2(r - 1)}{\Sigma}\)
                                    </td>
                                </tr>
                                <tr align="center">
                                    <td style="border: 1px solid">
                                        \(\theta ' = \frac{1}{\Sigma}p_{\theta}\)
                                    </td>
                                    <td style="border: 1px solid">
                                        \(p_{\theta}' = \frac{\sin\theta \cos\theta (\frac{L^2}{a^2} - a^2)}{\Sigma}\)
                                    </td>
                                </tr>
                                <tr align="center">
                                    <td style="border: 1px solid">
                                        \(\phi ' = \frac{2ar + (\Sigma - 2r)\frac{L}{\sin^2\theta}}{\Delta\Sigma}\)
                                    </td>
                                    <td style="border: 1px solid">
                                        \(p_{\phi}' = 0\)
                                    </td>
                                </tr>                                
                                <tr align="center">
                                    <td style="border: 1px solid">
                                        \(t' = \frac{1 + (2r(r^2 + a^2) - 2arL)}{\Delta\Sigma}\)
                                    </td>
                                    <td style="border: 1px solid">
                                        \(p_t' = 0\)
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </p>
                </div>

                <h3>Improvements: Cash-Karp Method</h3>
                <div>
                    <p> Our ray marching approach for Kerr black holes uses the Cash-Karp method, a fifth-order Runge-Kutta method with an adaptive step size. Cash-Karp is particularly efficient for ODEs with rapidly changing behavior by decreasing step sizes when the solution changes rapidly (such as when we are closer to the black hole), increasing accuracy as well as efficiency.
                    </p>
                    <p>
                        At each timestep, we integrate forward via Cash-Karp and update our ray‚Äôs null geodesic properties. A more complete description of this process is described in Appendix B. Like in our first approach, we perform the following ray-intersection tests:

                    </p>
                    <ol>
                        <li>
                            If we find that the ray‚Äôs r-coordinate is less than the black hole‚Äôs event horizon radius, we know that the ray has fallen into the black hole.
                        </li>
                        <li>
                            Our accretion disk intersection test remains similar to our first approach; we check if the ray has intersected the accretion disk plane between the disk‚Äôs inner and outer radius.
                        </li>
                        <li>
                            If the ray‚Äôs r-coordinate is greater than the camera‚Äôs r-coordinate, or if we have exceeded the max number of steps without intersecting anything, we assume that the ray has escaped to infinity (and map it to a background starfield texture).
                        </li>
                    </ol>
                </div>

                <h3>Improvments: Texture Mapping of Background and Accretion Disk</h3>
                <div>
                    <p>
                        For a more realistic accretion disk, we asked an artist friend to create an accretion disk texture for us, pictured here:

                    </p>
                    <div align="middle">
                        <table style="width:100%">
                        <tr align="center">
                            <td>
                            <img src="alpha_channel/george.png" align="middle" width="400px"/>
                            <figcaption> Credit: George Geng</figcaption>
                            </td>
                        </tr>
                        </table>
                    </div>

                    <p> Our custom accretion disk texture includes an alpha-channel, which we use to create semi-transparent feathering of the accretion disk. When a ray intersects the accretion disk during ray-marching, instead of terminating the ray, we march the ray through the accretion disk to also obtain the color of the black hole/background intersection(s) behind it. Then, we linearly interpolate the color of the accretion disk and future intersections with the accretion‚Äôs alpha value to achieve the partially transparent effect. </p>
                    
                    <div align="middle">
                        <table style="width:100%">
                        <tr align="center">
                            <td>
                            <img src="alpha_channel/no_alpha.png" align="middle" width="400px"/>
                            <figcaption>Fully Opaque Accretion Disk</figcaption>
                            </td>
                            <td>
                            <img src="alpha_channel/alpha.png" align="middle" width="400px"/>
                            <figcaption>Semi-transparent Accretion Disk</figcaption>
                            </td>
                        </tr>
                        </table>
                    </div>
                    <p><i>Notable Observations: In the semi-transparent accretion disk render, we can see hints of the blue background and stars showing through the edges of the accretion disk. While subtle, this really contributes to a more realistic look.</i></p>
                </div>

                <h3>Improvements: Bloom Filter Effect</h3>
                <div>
                    <p> As a post-processing effect, we apply a bloom filter to simulate camera lens flare and brighter intensity of the accretion disk. Bloom also creates a glowing effect where the light of the accretion disk appears to bleed over the edges. After the ray-marching process, we take a square Gaussian kernel and convolve it with each of the pixel colors that belong to the accretion disk. We add this output back to the frame buffer before writing out an image file. Below are images where we gradually increase the intensity of the bloom effect. </p>
                    <div align="middle">
                        <table style="width:100%">
                    
                            <tr align="center">
                                <td>
                                <img src="bloom/kerr_0.6_500_nobg_nobloom.png" align="middle" width="200px"/>
                                <figcaption> No Bloom</figcaption>
                                </td>
                                <td>
                                <img src="bloom/kerr_0.6_500_nobg_bloom_41_13_8.png" align="middle" width="200px"/>
                                <figcaption> Some Bloom </figcaption>
                                </td>
                            <!-- </tr>
                            <tr align="center"> -->
                                <td>
                                <img src="bloom/kerr_0.6_500_nobg_bloom_41_41.png" align="middle" width="200px"/>
                                <figcaption> More Bloom</figcaption>
                                </td>
                                <td>
                                <img src="bloom/kerr_0.6_500_nobg_bloom_41_57_1.png" align="middle" width="200px"/>
                                <figcaption>Too Much Bloom</figcaption>
                                </td>
                            </tr>
                        </table>
                        <table style="width:100%">
                            <tr align="center">
                                <td>
                                <img src="bloom/bloom_star.png" align="middle" width="400px"/>
                                <figcaption>Bloom with Starfield</figcaption>
                                </td>
                                <td>
                                    <img src="bloom/bloom_star2.png" align="middle" width="400px"/>
                                    <figcaption>Bloom with Starfield</figcaption>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <p>
                        <i>
                        We think that the level of bloom in #3 is the best visually; there 
                        is a subtle glowing effect that still showcases the structure of the accretion disk fairly well.
                        </i>
                    </p>
                </div>


                <h3>[Attempted] Improvments: Early Ray Termination Optimization</h3>
                <div>
                    <p>
                        This paper describes the rendering methods used by DNEG to produce the images of a spinning black hole in the movie Interstellar. Before marching a ray, DNEG uses an early ray termination algorithm that calculates whether or not the ray originates from the black hole‚Äôs event horizon; if it does, the ray does not need to be considered further. DNEG only performs numerical integration for rays that originate from the accretion disk or the celestial sphere/starfield background.
                    </p>
                    <p>
                        We attempted this, but ran into some mathematical bugs that we were unable to resolve in time. Our implementation just integrates all rays, which is slower but should yield similar results. Heavy optimization on our end is less necessary since we did not attempt to create large-scale animations.
                    </p>
                </div>
            </div>

            <h2> Problems Encountered and Lesson Learned</h2>
            <div>
                <p>
                    Throughout this project, one of the difficulties we encountered were surrounding the technical approaches of our blackhole implementation. It was difficult to understand physics formulas presented in the paper and parse the heavy mathematical explanations for the existing blackhole models we read about in the references. 

                </p>
                <p>
                    We also spend some time understanding the starter code provided by project 3 and project 4. Previously, we treated a lot of the code provided in the starter skeleton as a black box and this project gave us an opportunity to explore how the ray tracing and simulation systems were set up. 
                    This understanding influenced our design decisions when setting up the ray-marching infrastructure.
                </p>
                <p>
                    Through this project, we also gained some insights into the nuanced differences between various blackhole models and the ray marching algorithm. Overall, we learned a lot through researching, implementing, and exploring!

                </p>
                <p>
                    Lessons learned: this entire project was one large bug. Haha pain.

                </p>
            </div>
        </div>

        <p>


        <div>
            <h1> Final Results </h1>
            
            <p>
                The two gifs shown below demonstrate the effect of varying the inclination angle of the accretion disk, simulating the effect of a camera orbiting a black hole.
            </p>
            <h2> Varing Inclination Angle</h2>
            <div align="middle">
                <table style="width:100%">
                <tr align="center">
                    <td>
                    <img src="inclination_gif/check_incline_sim_full.gif" align="middle" width="400px"/>
                    <figcaption></figcaption>
                    </td>
                    <td>
                    <img src="inclination_gif/text_incline_sim_full.gif" align="middle" width="400px"/>
                    <figcaption></figcaption>
                    </td>
                </tr>
                </table>
            </div>
            
            <p>
                The next two gifs demonstrate the effects of varying the black hole‚Äôs angular momentum. We observe changes in the black hole size and asymmetric distortions of both the accretion disk and background. 
            </p>

            <h2> Varing Angular Momentum</h2>
            <div align="middle">
                <table style="width:100%">
                <tr align="center">
                    <td>
                    <img src="angular_momentum_gif/check_a_sim_full.gif" align="middle" width="400px"/>
                    <figcaption></figcaption>
                    </td>
                    <td>
                    <img src="angular_momentum_gif/text_a_sim_full.gif" align="middle" width="400px"/>
                    <figcaption></figcaption>
                    </td>
                </tr>
                </table>
            </div>
            <p>
                The following 4 images also demonstrate effects of varying the angular momentum, with the camera placed further away from the black hole so that we can see more of the starfield. One more noticeable change is the counterclockwise rotation of images on the Einstein Ring as angular momentum increases.
            </p>
            <div align="middle">
                <table style="width:100%">
                <tr align="center">
                    <td>
                        <img src="a-values/kerr_0.1_500_bg1_bloom_41_13_4.png" align="middle" width="200px"/>
                        <figcaption>a = 0.1</figcaption>
                    </td>
                    <td>
                        <img src="a-values/kerr_0.3_500_bg1_bloom_41_13_4.png" align="middle" width="200px"/>
                        <figcaption>a = 0.3</figcaption>
                    </td>
                    <td>
                        <img src="a-values/kerr_0.6_500_bg1_bloom_41_13_4.png" align="middle" width="200px"/>
                        <figcaption>a = 0.6</figcaption>
                    </td>
                    <td>
                        <img src="a-values/kerr_0.9_500_bg1_bloom_41_13_4.png" align="middle" width="200px"/>
                        <figcaption>a = 0.9</figcaption>
                    </td>
                </tr>
                </table>
            </div>

            <br>


            <h3> Starfield Accretion Texture Mapping Results</h3>
            <p>Lastly, we present some large, high-quality renders we produced. From the starfields on the left, we generated the images on the right. These took roughly 6.5 hours each on a 10 core machine:
            </p>

            <div align="middle">
                <table style="width:100%">
                <tr align="center">
                    <td>
                    <img src="final_images/5.png" align="middle" width="200px"/>
                    </td>
                    <td>
                    <img src="final_images/text_5.png" align="middle" width="600px"/>
                    </td>
                </tr>
                <tr align="center">
                    <td>
                    <img src="final_images/3.png" align="middle" width="200px"/>
                    </td>
                    <td>
                    <img src="final_images/text_3.png" align="middle" width="600px"/>
                    </td>
                </tr>
                <tr align="center">
                    <td>
                        <img src="final_images/2.png" align="middle" width="200px"/>
                    </td>
                    <td>
                        <img src="final_images/text_2.png" align="middle" width="600px"/>
                    </td>
                </tr>
                <tr align="center">
                    <td>
                        <img src="final_images/1.png" align="middle" width="200px"/>
                    </td>
                    <td>
                        <img src="final_images/text_1.png" align="middle" width="600px"/>
                    </td>
                </tr>
                </table>
            </div>
            <p>As is standard practice in classes, we are obligated to use the professor‚Äôs faces for a meme render. Or perhaps‚Ä¶ a RENder:
            </p>
            <p> Behold the infinite</p>
            <div align="middle">
                <table style="width:100%">
                    <tr align="center">
                        <td>
                            <img src="final_images/prof_ren.png" align="middle" width="400px"/>
                            <figcaption>Professor Ren Ng</figcaption>
                        </td>
                        <td>
                            <img src="final_images/prof_obrien.png" align="middle" width="400px"/>
                            <figcaption>Professor James O'Brien</figcaption>
                        </td>
                    </tr>
                </table>
            </div>
        </div>  
        
        <br>

        <div>
            <h2> References </h2>
            <ul>
                <li>
                    [1] <i>Interstellar</i> paper: 
                    <a href= "https://iopscience.iop.org/article/10.1088/0264-9381/32/6/065001/pdf">
                        https://iopscience.iop.org/article/10.1088/0264-9381/32/6/065001/pdf 
                    </a>
                </li>
                <li>
                    [2] Bloom shader filter: <a href = " https://learnopengl.com/Advanced-Lighting/Bloom">
                        https://learnopengl.com/Advanced-Lighting/Bloom
                    </a>
                </li>
                <li> 
                    [3] 
                    Reference 1: 
                    <a href = "https://rantonels.github.io/starless/">https://rantonels.github.io/starless/</a></li>
                <li>
                    [4]
                    Reference 2: 
                    <a href = "http://locklessinc.com/articles/raytracing/">
                        http://locklessinc.com/articles/raytracing/
                    </a>
                </li>
                <li>
                    [5] Reference 3: 
                    <a href = "https://www.codeproject.com/Articles/994466/Ray-Tracing-a-Black-Hole-in-Csharp">
                        https://www.codeproject.com/Articles/994466/Ray-Tracing-a-Black-Hole-in-Csharp
                    </a>                    
                </li>
                <li>
                    [6] Kerr Metric: 
                    <a href = "https://en.wikipedia.org/wiki/Kerr_metric">
                        https://en.wikipedia.org/wiki/Kerr_metric
                    </a>
                </li>
                <li>
                    [7] Boyer-Lindquist: 
                    <a href = "https://en.wikipedia.org/wiki/Boyer‚ÄìLindquist_coordinates">
                        https://en.wikipedia.org/wiki/Boyer‚ÄìLindquist_coordinates
                    </a>
                </li>
                <li>
                    [8] Cash-Karp method: 
                    <a href = "https://en.wikipedia.org/wiki/Cash‚ÄìKarp_method">
                        https://en.wikipedia.org/wiki/Cash‚ÄìKarp_method
                    </a>
                </li>
                <li>
                    [9] Runge-Kutta method: 
                    <a href = "https://en.wikipedia.org/wiki/Runge‚ÄìKutta_methods">
                        https://en.wikipedia.org/wiki/Runge‚ÄìKutta_methods
                    </a>
                </li>
                <li>
                    [10] Ray Diagram: 
                    <a href = "https://galileo-unbound.blog/2019/07/29/orbiting-photons-around-a-black-hole/">
                        https://galileo-unbound.blog/2019/07/29/orbiting-photons-around-a-black-hole/
                    </a>
                </li>
            </ul>
        </div> 

        <br>

        <div>
            <h2> Team Contributions </h2>
            <h4> Grace Chen</h4>
            <ul>
                <li>Attempted alpha channel mapping (generated many bug art instead)
                </li>
                <li>
                    Rendered animated gifs to demonstrate varying inclination angle
                </li>
                <li>
                    Attempted simulation by modifying project 4 codebase (it didn‚Äôt work out TT)
                </li>
            </ul>
            <h4> Jerry Zhang</h4>
            <ul>
                <li>
                    Rendered animated gifs to demonstrate varying inclination angle
                </li>
                <li>
                    Modified CLI interface to take in inclination and alpha as parameters
                </li>
                <li>
                    Edited Video
                </li>
            </ul>
                
            <h4> Mingyang Wang</h4>
            <ul>
                <li>Set up ray marching infrastructure
                </li>
                <li>
                    Implemented alpha texture mapping for partially transparent accretion disk
                </li>
                <li>
                    Attempted Early Ray Termination Optimization

                </li>
                <li>
                    Set up Boyer-Lindquist + Cash-Karp infrastructure
                </li>
            </ul>
            <h4> Irene Geng</h4>
            <ul>
                <li>
                    Set up ray marching infrastructure
                </li>
                <li>
                    Bloom Filter
                </li>
                <li>
                    Attempted Early Ray Termination Optimization
                </li>
                <li>
                    Set up Boyer-Lindquist + Cash-Karp infrastructure
                </li>
            </ul>
        </div> 

        <br>

        <div> 
            <h1> Appendix</h1>
            <div>
               
                <h3> A: the acceleration derivation </h3>
                <p>
                    The following derivation was taken from [3]:
                </p>
                <p>
                    For a Schwarzschild Black Hole, the angular momentum \(a = 0\) and charge \(Q = 0\). Additionally, we normalize the speed of light \(c = 1\) and the black hole‚Äôs Schwarzchild radius \(r_s = 1\). Therefore, the line element (in spherical coordinates) can be defined as:
                    \[ds^2 = (1 - \frac{1}{r})dt^2 - (1 - \frac{1}{r})^{-1}dr^2 - r^2d\theta^2 - r^2\sin^2\theta d\phi^2\]
                </p>
                <p>
                    We set \(\theta = \frac{\pi}{2}\), so \(d\theta = 0\). Additionally, we define \(e = (1 - \frac{1}{r})\frac{dt}{d\tau}\) and \(l = r^2 \frac{d\phi}{d\tau}\), and then set \(ds^2 = 1\).
                    \[(1 - \frac{1}{r})dt^2 - (1 - \frac{1}{r})^{-1}dr^2 - r^2d\theta^2 - r^2\sin^2\theta d\phi^2 = 1\]
                    \[\frac{1}{1 - \frac{1}{r}} * e^2 - \frac{1}{1 - \frac{1}{r}}\frac{dr^2}{d\tau^2} - r^2 * 0 - \frac{l^2}{r^2} = 1\]
                    \[\frac{1}{1 - \frac{1}{r}}\frac{dr^2}{d\tau^2} = \frac{1}{1 - \frac{1}{r}} * e^2 - 1 - \frac{l^2}{r^2}\]
                    \[\frac{dr^2}{d\tau^2} = e^2 - (1 - \frac{1}{r}) (1 + \frac{l^2}{r^2})\]
                    \[r^4 \frac{dr^2}{d\tau^2} = r^4 \frac{dr^2}{d\phi^2}\frac{d\phi^2}{d\tau^2} = l^2 \frac{dr^2}{d\phi^2} = r^4 e^2 - (1 - \frac{1}{r}) (r^4 + r^2l^2)\]
                    \[\frac{dr^2}{d\phi^2} = \frac{r^4 e^2}{l^2} - (1 - \frac{1}{r}) (\frac{r^4}{l^2} + r^2)\]

                
                
                </p>
                <p>
                    We then perform the change of coordinates \(r \implies u = \frac{1}{r}\), yielding:
                    \[\frac{du^2}{d\phi^2} = \frac{1}{b^2} - (1 - u) (a^{-2} + u^2)\]
                    where \(b = \frac{l}{e})\ and \(a = l\)
                </p>
                <p>
                    We take \(\lim_{a \to \inf}\), so \(\frac{du^2}{d\phi^2} = \frac{1}{b^2} - (1 - u) (u^2)\)

                </p>
                <p>
                    This equation can then be solved to yield: \(u^{''}(\phi) = -u (1 - \frac{3}{2} u^2)\), or \(u^{''}(\phi) + u = \frac{3}{2} u^3\).
                </p>
                <p>
                    The Binet equation for the equation for orbit of a particle is \(u^{''} + u = - \frac{1}{mh^2u^2}F(u)\)
                </p>
                <p>
                    By setting \(m = 1\), equating the above two equations, and plugging back in \(r = \frac{1}{u}\), we obtain:
                    \(F = a = -\frac{3}{2}h^2\frac{\hat{r}}{r^5}\), which we can use for ray marching
                </p>

                <h2> B: Cash-Karp Integration </h2>
                <div>
                    <p>
                        The Cash-Karp method is a type of Runge-Kutta method (the same family as Forward Euler Integration), which approximate the solution of an ODE by iteratively computing a sequence of intermediate values that depend on the previous values and the derivatives of the function at those values. Cash-Karp is a fifth order method, and estimates/integrates forward via:
                        \[y_{n+1} = y_n + h \sum_{i=1}^s b_i k_i\]
                        where:
                        <ul>
                            <li>\(k_1 = f(t_n, y_n)\)</li>
                            <li>\(k_2 = f(t_n + \frac{1}{5}*h, y_n + \frac{1}{5}k_1*h)\)</li>
                            <li>\(k_3 = f(t_n + \frac{3}{10}*h, y_n + (\frac{3}{40}k_1 + \frac{9}{40}k_2)*h)\)</li>
                            <li>\(k_4 = f(t_n + \frac{3}{5}*h, y_n + (\frac{3}{10}k_1 - \frac{9}{10}k_2 + \frac{6}{5}k_3)*h)\)</li>
                            <li>\(k_5 = f(t_n + h, y_n + (\frac{-11}{54}k_1 - \frac{5}{2}k_2 + \frac{-70}{27}k_3 + \frac{35}{27}k_4)*h)\)</li>
                            <li>\(k_6 = f(t_n + \frac{7}{8} h, y_n + (\frac{1631}{55296}k_1 - \frac{175}{512}k_2 + \frac{575}{13824}k_3 + \frac{44275}{110592}k_4 + \frac{253}{4096}k_5)*h)\)</li>
                            <li>\(b_1 = \frac{37}{378}\)</li>
                            <li>\(b_2 = 0\)</li>
                            <li>\(b_3 = \frac{250}{621}\)</li>
                            <li>\(b_4 = \frac{125}{594}\)</li>
                            <li>\(b_5 = 0\)</li>
                            <li>\(b_6 = \frac{512}{1771}\)</li>
                        </ul>
                    </p>
                    <p> 
                        Additionally, Cash-Karp includes a sixth-order estimate to estimate the error of the fifth order solution.  For every timestep, if the error estimate is too large, then Cash-Karp reduces the step size until the error is below some threshold. Error is calculated via
                        \[e_{n+1} = y_{n+1} - y_{n+1}^* = h \Sigma_{i=1}^s(b_i - b_i^*)k_i\], where:
                        <ul>
                            <li>\(y_{n+1}^* = y_n + h \Sigma_{i=1}^sb_i^*k_i\)</li>
                            <li>\(b_1^* = \frac{2825}{27648}\)</li>
                            <li>\(b_2^* = 0\)</li>
                            <li>\(b_3^* = \frac{18575}{48384}\)</li>
                            <li>\(b_4^* = \frac{13525}{55296}\)</li>
                            <li>\(b_5^* = \frac{277}{14336}\)</li>
                            <li>\(b_6^* = \frac{1}{4}\)</li>
                        </ul>
                    </p>
                    <p> 
                        Cash-Karp is advantageous because it allows for high accuracy and efficiency due to its adaptive step size control. In our application, this allows us to take large step sizes while far away from the black hole (where the effect of gravitational lensing is less apparent) and smaller step sizes while close to the black hole, where photon trajectories change drastically.

                    </p>
                </div>
                <h2>C: Textures </h2>
                <div>
                    <p>Our checkerboard textures used for debugging consisted of grids created in Photoshop:
                    </p>
                    <div align="middle">
                        <table style="width:100%">
                            <tr align="center">
                                <td>
                                    <img src="checker/checker-blue-white.png" align="middle" width="200px"/>
                                    <figcaption></figcaption>
                                </td>
                                <td>
                                    <img src="checker/checker-red-black.png" align="middle" width="200px"/>
                                    <figcaption></figcaption>
                                </td>
                                <td>
                                    <img src="checker/checker-magenta-white.png" align="middle" width="200px"/>
                                    <figcaption></figcaption>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <p>Our custom accretion disk texture was created by artist George Geng:</p>
                    <div align="middle">
                        <table style="width:100%">
                            <tr align="center">
                                <td>
                                    <img src="alpha_channel/george.png" align="middle" width="400px"/>
                                    <figcaption></figcaption>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <p>The various background starfield textures we used:</p>
                    <div align="middle">
                        <table style="width:100%">
                        <tr align="center">
                            <td>
                                <img src="final_images/1.png" align="middle" width="400px" height = "300px"/>
                                <figcaption></figcaption>
                            </td>
                            <td>
                                <img src="final_images/2.png" align="middle" width="400px" height = "300px"/>
                                <figcaption></figcaption>
                            </td>
                        </tr>
                        <tr align="center">
                            <td>
                                <img src="final_images/3.png" align="middle" width="400px" height = "300px"/>
                                <figcaption></figcaption>
                            </td>
                            <td>
                                <img src="final_images/4.png" align="middle" width="400px" height = "300px"/>
                                <figcaption></figcaption>
                            </td>
                        </tr>
                        </table>
                    </div>

                </div>
            </div>
            <br>
            
            <h2>D: Bug Art Gallery</h2>
            <div align="middle">
                <table style="width:100%">
                <tr align="center">
                    <td>
                        <img src="bug_art/image1.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image10.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image15.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image13.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                </tr>
                <tr align="center">
                    <td>
                        <img src="bug_art/image18.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image14.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image9.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image16.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                </tr>
                <tr align="center">
                    <td>
                        <img src="bug_art/image7.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image4.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image5.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                    <td>
                        <img src="bug_art/image3.png" align="middle" width="200px"/>
                        <figcaption></figcaption>
                    </td>
                </tr>
                </table>
            </div>
            <br>
        
        </div>


        </div>
        <br>
        <div>
           
        </div>
    </body>
</html>